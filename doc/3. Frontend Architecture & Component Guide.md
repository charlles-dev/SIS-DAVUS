# **3\. Frontend Architecture & Component Guide**

Stack: React 18, Vite, TypeScript, Tailwind CSS, Shadcn/UI, React Query, Zustand.  
Hospedagem: Vercel (Free).

## **1\. Gerenciamento de Estado & Cache (Crucial para Free Tier)**

Como o Backend pode ser lento, o Frontend assume a responsabilidade de parecer rápido ("Optimistic UI").

### **1.1. React Query Config (src/lib/queryClient.ts)**

import { QueryClient } from '@tanstack/react-query';

export const queryClient \= new QueryClient({  
  defaultOptions: {  
    queries: {  
      retry: 2,  
      staleTime: 1000 \* 60 \* 5, // 5 minutos. Dados não expiram rápido.  
      gcTime: 1000 \* 60 \* 30, // 30 min em cache (garbage collection).  
      refetchOnWindowFocus: false, // Evita refetch agressivo e cold starts desnecessários.  
    },  
  },  
});

### **1.2. Stores Globais (Zustand)**

* useAuthStore: Persistido no localStorage. Armazena JWT e User Profile.  
* useCartStore: Carrinho de movimentações. Permite ao almoxarife adicionar 20 itens offline e enviar um "Batch Checkout" quando a conexão voltar.

## **2\. Componentes de Performance**

### **2.1. ServerAwakeGuard.tsx**

Um componente wrapper que detecta latência.

* **Lógica:** Intercepta requests. Se pending \> 2s, exibe Toast: *"Conectando ao servidor seguro..."*. Se \> 10s: *"Servidor em wake-up, aguarde..."*.  
* **UX:** Evita que o usuário ache que o app travou.

### **2.2. ImageCompressor.ts**

Utilitário obrigatório antes de qualquer POST de imagem.

* **Lib:** browser-image-compression.  
* **Config:**  
  const options \= {  
    maxSizeMB: 0.5, // Máximo 500KB  
    maxWidthOrHeight: 1280,  
    useWebWorker: true,  
    fileType: 'image/webp' // Força WebP  
  }

## **3\. Estrutura de Diretórios Otimizada**

/src  
  /api          \# Definições de endpoints (Axios)  
  /assets       \# SVGs leves  
  /components  
    /feedback   \# Loaders, Skeletons (Crucial para cold start)  
    /form       \# Inputs com debounce (Evita spam de requests)  
  /hooks  
    useServerStatus.ts \# Hook de verificação de saúde da API  
  /lib  
    supabase.ts \# Cliente (apenas se formos ler storage direto)

## **4\. Service Worker (PWA)**

Configurar vite-plugin-pwa:

* Cache de fontes, CSS e JS.  
* Cache de GET /api/v1/inventory/products/ (stale-while-revalidate) para permitir consulta de catálogo mesmo sem internet momentânea.